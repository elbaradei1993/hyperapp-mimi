<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HyperApp - Community Safety Platform</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <style>
    :root {
      /* Weather App Color System */
      --light-primary: #000000;
      --light-secondary: rgba(60, 60, 67, 0.6);
      --light-tertiary: rgba(60, 60, 67, 0.3);
      --light-quaternary: rgba(60, 60, 67, 0.16);
      --light-background: #FFFFFF;
      --light-surface: #FFFFFF;
      --light-on-surface: #000000;

      --dark-primary: #FFFFFF;
      --dark-secondary: rgba(235, 235, 245, 0.6);
      --dark-tertiary: rgba(235, 235, 245, 0.3);
      --dark-quaternary: rgba(235, 235, 245, 0.16);
      --dark-background: #000000;
      --dark-surface: #1C1C1E;
      --dark-on-surface: #FFFFFF;

      /* Weather App Gradients */
      --gradient-primary: linear-gradient(135deg, #2E335A, #5936B4, #3658B1);
      --gradient-secondary: linear-gradient(135deg, #AEC9FF, #083072);
      --gradient-radial: radial-gradient(circle, #F7CBFD, #612FAB);
      
      /* Weather App Solid Colors */
      --solid-primary: #48319D;
      --solid-secondary: #1F1D47;
      --solid-accent: #C427FB;
      --solid-light-accent: #E0D9FF;

      /* Glassmorphism properties */
      --glass-bg: rgba(255, 255, 255, 0.2);
      --glass-border: rgba(255, 255, 255, 0.3);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      --glass-blur: blur(15px);
      --glass-blur-sm: blur(10px);

      /* Weather App Typography Scale */
      --font-size-caption2: 11px;
      --font-size-caption1: 12px;
      --font-size-footnote: 13px;
      --font-size-subheadline: 15px;
      --font-size-callout: 16px;
      --font-size-body: 17px;
      --font-size-headline: 17px;
      --font-size-title3: 20px;
      --font-size-title2: 22px;
      --font-size-title1: 28px;
      --font-size-largetitle: 34px;

      /* Font Weights */
      --font-weight-regular: 400;
      --font-weight-bold: 700;

      /* Default theme (light) */
      --primary: var(--light-primary);
      --secondary: var(--light-secondary);
      --tertiary: var(--light-tertiary);
      --quaternary: var(--light-quaternary);
      --background: var(--light-background);
      --surface: var(--light-surface);
      --on-surface: var(--light-on-surface);
      --card-bg: var(--light-surface);
      --text-primary: var(--light-primary);
      --text-secondary: var(--light-secondary);
      --border: var(--light-quaternary);

      /* Spacing */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;

      /* Border Radius */
      --border-radius-sm: 8px;
      --border-radius: 12px;
      --border-radius-lg: 16px;
      --border-radius-xl: 20px;

      /* Shadows */
      --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.15);
    }

    [data-theme="dark"] {
      --primary: var(--dark-primary);
      --secondary: var(--dark-secondary);
      --tertiary: var(--dark-tertiary);
      --quaternary: var(--dark-quaternary);
      --background: var(--dark-background);
      --surface: var(--dark-surface);
      --on-surface: var(--dark-primary);
      --card-bg: var(--dark-surface);
      --text-primary: var(--dark-primary);
      --text-secondary: var(--dark-secondary);
      --border: var(--dark-quaternary);
      
      /* Dark glassmorphism */
      --glass-bg: rgba(0, 0, 0, 0.2);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      background: var(--background);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 0;
      overflow-x: hidden;
      line-height: 1.4;
      font-weight: var(--font-weight-regular);
      font-size: var(--font-size-body);
    }

    .container {
      max-width: 100%;
      padding: var(--space-4);
      margin: 0 auto;
      padding-bottom: 80px;
    }

    /* Compact Hero Section */
    .compact-hero {
      background: var(--gradient-primary);
      color: white;
      padding: 30px 20px;
      border-radius: var(--border-radius-lg);
      text-align: center;
      margin-bottom: var(--space-5);
      box-shadow: var(--shadow-lg);
      animation: heroSlideIn 0.6s ease-out;
      position: relative;
      overflow: hidden;
    }

    .compact-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--glass-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius-lg);
      z-index: 1;
    }

    .compact-hero > * {
      position: relative;
      z-index: 2;
    }

    .hero-logo {
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-3);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .hero-logo i {
      font-size: 28px;
    }

    .hero-title {
      font-size: var(--font-size-title2);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-2);
      line-height: 1.3;
    }

    .hero-subtitle {
      font-size: var(--font-size-callout);
      opacity: 0.9;
      margin-bottom: var(--space-4);
    }

    .hero-stats {
      display: flex;
      justify-content: center;
      gap: var(--space-5);
      margin-bottom: var(--space-4);
    }

    .hero-stat {
      text-align: center;
    }

    .hero-stat-value {
      font-size: var(--font-size-title3);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-1);
    }

    .hero-stat-label {
      font-size: var(--font-size-caption1);
      opacity: 0.8;
    }

    .hero-actions {
      display: flex;
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .hero-btn {
      flex: 1;
      padding: var(--space-3) var(--space-4);
      border-radius: 50px;
      font-weight: var(--font-weight-bold);
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
    }

    .hero-btn-primary {
      background: white;
      color: var(--solid-primary);
    }

    .hero-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .hero-btn-secondary {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .hero-btn-secondary:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    .hero-live-info {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--space-2);
      font-size: var(--font-size-caption1);
      opacity: 0.9;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: #00D4AA;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    /* Bento Grid Layout */
    .bento-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: minmax(150px, auto);
      gap: 16px;
      margin-bottom: 70px;
    }

    .bento-card {
      background: var(--glass-bg);
      border-radius: var(--border-radius-lg);
      padding: var(--space-5);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      animation: cardSlideUp 0.5s ease-out both;
    }

    .bento-card:nth-child(1) { animation-delay: 0.1s; }
    .bento-card:nth-child(2) { animation-delay: 0.15s; }
    .bento-card:nth-child(3) { animation-delay: 0.2s; }
    .bento-card:nth-child(4) { animation-delay: 0.25s; }
    .bento-card:nth-child(5) { animation-delay: 0.3s; }
    .bento-card:nth-child(6) { animation-delay: 0.35s; }

    .bento-card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-3px);
    }

    /* Card sizes for bento layout */
    .bento-card-large {
      grid-column: span 2;
      grid-row: span 2;
    }

    .bento-card-medium {
      grid-column: span 2;
    }

    .bento-card-small {
      grid-column: span 1;
    }

    /* Special gradient cards */
    .bento-card-primary,
    .bento-card-accent,
    .bento-card-secondary {
      position: relative;
      overflow: hidden;
    }

    .bento-card-primary::before,
    .bento-card-accent::before,
    .bento-card-secondary::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--glass-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius-lg);
      z-index: 1;
    }

    .bento-card-primary > *,
    .bento-card-accent > *,
    .bento-card-secondary > * {
      position: relative;
      z-index: 2;
    }

    .bento-card-primary {
      background: var(--gradient-primary);
      color: white;
    }

    .bento-card-primary .card-title {
      color: white;
    }

    .bento-card-accent {
      background: var(--solid-accent);
      color: white;
    }

    .bento-card-secondary {
      background: var(--solid-secondary);
      color: white;
    }

    /* White card for community stats */
    .bento-card-white {
      background: white;
      color: black;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .bento-card-white .card-title {
      color: black;
    }

    .bento-card-white .stat-number,
    .bento-card-white .stat-label,
    .bento-card-white .vibe-percentage,
    .bento-card-white .vibe-sidebar-label span,
    .bento-card-white .vibe-sidebar-count,
    .bento-card-white .sidebar-header span,
    .bento-card-white .dominant-vibe span {
      color: black;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      margin-bottom: var(--space-4);
      font-weight: var(--font-weight-bold);
      color: var(--primary);
      font-size: var(--font-size-title2);
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      padding: var(--space-3) var(--space-4);
      margin: var(--space-4) 0;
      border: 1px solid var(--glass-border);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      box-shadow: var(--glass-shadow);
    }

    .refresh-btn {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: var(--text-secondary);
      padding: var(--space-2);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 40px;
      min-height: 40px;
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .refresh-btn:hover {
      background: var(--quaternary);
      color: var(--primary);
    }

    .refresh-btn.spinning {
      animation: spin 1s linear infinite;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-size: var(--font-size-footnote);
      color: var(--text-secondary);
    }

    .connected {
      color: #28A745;
    }

    .disconnected {
      color: #DC3545;
    }

    .app-nav {
      display: flex;
      justify-content: space-around;
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      padding: 10px;
      margin: 15px 0;
      border: 1px solid var(--glass-border);
      position: fixed;
      bottom: 15px;
      left: 15px;
      right: 15px;
      z-index: 100;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      box-shadow: var(--glass-shadow);
    }

    .nav-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      padding: 10px;
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      display: flex;
      justify-content: center;
      position: relative;
    }

    .nav-btn.active {
      color: var(--solid-primary);
    }

    .nav-btn i {
      font-size: var(--font-size-title3);
    }

    .content-area {
      margin-bottom: 70px;
    }

    .view {
      display: none;
      animation: fadeIn 0.3s ease-out;
    }

    .view.active {
      display: block;
    }

    .action-buttons-section {
      display: flex;
      justify-content: space-between;
      gap: var(--space-2);
      margin: var(--space-5) 0;
    }

    .action-buttons-section .action-btn {
      flex: 1;
      background: var(--solid-primary);
      color: white;
      border: none;
      border-radius: var(--border-radius-lg);
      padding: var(--space-4) var(--space-2);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-1);
    }

    .action-buttons-section .action-btn:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .action-buttons-section .action-btn.emergency {
      background: var(--solid-accent);
    }

    .action-buttons-section .action-btn i {
      font-size: var(--font-size-title3);
    }

    .action-buttons-section .action-btn span {
      font-size: var(--font-size-caption1);
      font-weight: var(--font-weight-bold);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-3);
      margin: var(--space-4) 0;
    }

    .stat-card {
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      padding: var(--space-4);
      text-align: center;
      border: 1px solid var(--glass-border);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .stat-number {
      font-size: var(--font-size-title1);
      font-weight: var(--font-weight-bold);
      color: var(--primary);
      margin-bottom: var(--space-1);
    }

    .stat-label {
      font-size: var(--font-size-caption1);
      color: var(--text-secondary);
    }

    .community-vibe-sidebar {
      margin-top: var(--space-4);
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-3);
    }

    .sidebar-header span {
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-callout);
    }

    .dominant-vibe {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-weight: var(--font-weight-bold);
    }

    .vibe-percentage {
      background: var(--glass-bg);
      color: var(--primary);
      padding: 2px 8px;
      border-radius: 20px;
      font-size: var(--font-size-caption1);
      font-weight: var(--font-weight-bold);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
      border: 1px solid var(--glass-border);
    }

    .vibe-sidebars-chart {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .vibe-sidebar-item {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-2) var(--space-3);
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .vibe-sidebar-label {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      min-width: 100px;
      font-weight: var(--font-weight-bold);
    }

    .vibe-sidebar-label span {
      font-size: var(--font-size-caption1);
    }

    .vibe-sidebar-bar {
      flex: 1;
      height: 20px;
      background: var(--quaternary);
      border-radius: 10px;
      overflow: hidden;
    }

    .vibe-sidebar-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 1.2s ease;
    }

    .vibe-sidebar-count {
      min-width: 30px;
      text-align: right;
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-caption1);
    }

    .safety-hub {
      display: flex;
      flex-direction: column;
      gap: var(--space-3);
    }

    .geofence-control {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: var(--space-4);
      transition: all 0.3s ease;
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .geofence-header {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      margin-bottom: var(--space-2);
    }

    .geofence-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--solid-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: var(--font-size-callout);
    }

    .geofence-info {
      flex: 1;
    }

    .geofence-title {
      display: block;
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-callout);
      margin-bottom: 2px;
    }

    .geofence-status {
      display: block;
      font-size: var(--font-size-caption1);
      color: var(--text-secondary);
    }

    .geofence-toggle {
      background: var(--quaternary);
      border: none;
      padding: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 28px;
      border-radius: 14px;
      position: relative;
      transition: all 0.3s ease;
    }

    .geofence-toggle.active {
      background: var(--solid-primary);
    }

    .toggle-slider {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .toggle-knob {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .geofence-toggle.active .toggle-knob {
      transform: translateX(22px);
    }

    .weather-alert {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: var(--space-3);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .weather-alert i {
      font-size: var(--font-size-title2);
      color: var(--solid-primary);
    }

    .alert-content {
      flex: 1;
    }

    .alert-title {
      font-weight: var(--font-weight-bold);
      color: var(--primary);
      margin-bottom: 2px;
    }

    .alert-message {
      font-size: var(--font-size-footnote);
      color: var(--text-secondary);
    }

    .guideline-item {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) 0;
      border-bottom: 1px solid var(--border);
    }

    .guideline-item:last-child {
      border-bottom: none;
    }

    .guideline-item i {
      font-size: var(--font-size-callout);
      color: var(--solid-primary);
      min-width: 16px;
      text-align: center;
    }

    .guideline-item span {
      font-size: var(--font-size-footnote);
      color: var(--text-primary);
    }

    .mood-voting-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-2);
    }

    .mood-vote-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-1);
      background: var(--glass-bg);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: var(--space-3) var(--space-2);
      transition: all 0.3s ease;
      cursor: pointer;
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .mood-vote-card:hover {
      border-color: var(--solid-primary);
    }

    .mood-vote-card.selected {
      background: var(--solid-primary);
      color: white;
      border-color: var(--solid-primary);
      transform: scale(1.05);
    }

    .mood-emoji {
      font-size: var(--font-size-title2);
      line-height: 1;
      margin-bottom: var(--space-1);
    }

    .mood-name {
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-caption1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .mood-voting-status {
      text-align: center;
      margin-top: var(--space-4);
      padding: var(--space-3);
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      border: 1px solid var(--glass-border);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .map-container {
      height: 300px;
      position: relative;
      background: var(--gradient-primary);
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: var(--space-4);
    }

    .map-visualization {
      height: 100%;
      width: 100%;
      position: relative;
    }

    .map-header {
      padding: var(--space-4);
      background: rgba(0, 0, 0, 0.5);
      color: white;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }

    .map-controls {
      position: absolute;
      top: 80px;
      right: 15px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .map-control-btn {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius-sm);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      color: var(--text-primary);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .map-control-btn:hover {
      transform: scale(1.1);
    }

    .map-control-btn.active {
      background: var(--solid-primary);
      color: white;
    }

    .map-legend {
      position: absolute;
      bottom: 15px;
      left: 15px;
      right: 15px;
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      padding: var(--space-2);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 6px;
      z-index: 1000;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: var(--font-size-caption2);
      color: var(--text-primary);
    }

    .heatmap-legend {
      position: absolute;
      bottom: 60px;
      left: 15px;
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      padding: var(--space-2);
      z-index: 1000;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
    }

    .heatmap-legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .heatmap-color {
      width: 20px;
      height: 4px;
      border-radius: 2px;
    }

    .heatmap-label {
      font-size: var(--font-size-caption2);
      color: var(--text-primary);
    }

    .reports-container {
      max-height: 300px;
      overflow-y: auto;
    }

    .report-item {
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      padding: var(--space-3);
      margin-bottom: var(--space-2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid var(--glass-border);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .report-info {
      flex: 1;
    }

    .report-type {
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-1);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .report-details {
      font-size: var(--font-size-footnote);
      color: var(--text-secondary);
      margin-bottom: var(--space-1);
    }

    .report-meta {
      font-size: var(--font-size-caption2);
      color: var(--text-secondary);
      display: flex;
      gap: var(--space-2);
    }

    .report-actions {
      display: flex;
      gap: var(--space-2);
    }

    .vote-btn {
      background: var(--quaternary);
      border: none;
      border-radius: var(--border-radius-sm);
      padding: var(--space-2) var(--space-3);
      cursor: pointer;
      color: var(--text-primary);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .vote-btn:hover:not([aria-disabled="true"]) {
      background: var(--tertiary);
    }

    .vote-btn[aria-disabled="true"] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .upvote-btn.active {
      color: #28A745;
      background: rgba(40, 167, 69, 0.2);
    }

    .downvote-btn.active {
      color: #DC3545;
      background: rgba(220, 53, 69, 0.2);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-content {
      background: var(--glass-bg);
      margin: 1% auto;
      width: 90%;
      max-width: 500px;
      border-radius: var(--border-radius-lg);
      overflow: hidden;
      animation: modalSlideIn 0.3s ease-out;
      border: 1px solid var(--glass-border);
      max-height: 98vh;
      display: flex;
      flex-direction: column;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      box-shadow: var(--glass-shadow);
    }

    .modal-header {
      background: var(--gradient-primary);
      padding: var(--space-4) var(--space-5);
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }

    .modal-header h2 {
      font-size: var(--font-size-title2);
      font-weight: var(--font-weight-bold);
    }

    .close {
      color: white;
      font-size: var(--font-size-title1);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .close:hover {
      transform: scale(1.1);
    }

    .modal-body {
      padding: var(--space-5);
      overflow-y: auto;
    }

    .form-group {
      margin-bottom: var(--space-5);
    }

    .form-group label {
      display: block;
      margin-bottom: var(--space-2);
      font-weight: var(--font-weight-bold);
    }

    .vibe-options {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-2);
    }

    .vibe-option {
      background: var(--glass-bg);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: var(--space-3) var(--space-2);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .vibe-option:hover {
      border-color: var(--solid-primary);
    }

    .vibe-option.selected {
      background: var(--solid-primary);
      color: white;
      border-color: var(--solid-primary);
    }

    .vibe-option i {
      font-size: var(--font-size-title2);
      margin-bottom: var(--space-1);
      display: block;
    }

    .vibe-option span {
      font-size: var(--font-size-caption1);
      font-weight: var(--font-weight-bold);
    }

    textarea, select, input {
      width: 100%;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: var(--space-3);
      color: var(--text-primary);
      resize: vertical;
      transition: all 0.3s ease;
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    textarea:focus, select:focus, input:focus {
      outline: none;
      border-color: var(--solid-primary);
    }

    .btn {
      background: var(--solid-primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      padding: var(--space-4) var(--space-5);
      cursor: pointer;
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-callout);
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      text-decoration: none;
      box-shadow: var(--shadow);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-emergency {
      background: var(--solid-accent);
      width: 100%;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--quaternary);
      border-radius: 50%;
      border-top: 3px solid var(--solid-primary);
      animation: spin 1s linear infinite;
      margin: 40px auto;
    }

    .no-data {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
      font-style: italic;
    }

    .notification {
      position: fixed;
      top: 20px;
      left: 16px;
      right: 16px;
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      padding: var(--space-4) var(--space-5);
      border: 2px solid var(--glass-border);
      z-index: 10000;
      animation: slideInDown 0.3s ease-out;
      display: flex;
      align-items: center;
      gap: var(--space-3);
      box-sizing: border-box;
      box-shadow: var(--glass-shadow);
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-callout);
      line-height: 1.4;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }

    .notification.success {
      background: rgba(40, 167, 69, 0.9);
      border-color: rgba(40, 167, 69, 0.5);
      color: white;
    }

    .notification.error {
      background: rgba(220, 53, 69, 0.9);
      border-color: rgba(220, 53, 69, 0.5);
      color: white;
    }

    .notification.warning {
      background: rgba(255, 193, 7, 0.9);
      border-color: rgba(255, 193, 7, 0.5);
      color: #000;
    }

    .notification.info {
      background: rgba(23, 162, 184, 0.9);
      border-color: rgba(23, 162, 184, 0.5);
      color: white;
    }

    /* Essential Animation Keyframes */
    @keyframes heroSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes cardSlideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideInDown {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Vibe-specific colors */
    .map-point[data-vibe="crowded"],
    .vibe-option[data-vibe="crowded"] {
      background: var(--solid-primary);
      color: white;
    }

    .map-point[data-vibe="noisy"],
    .vibe-option[data-vibe="noisy"] {
      background: var(--solid-secondary);
      color: white;
    }

    .map-point[data-vibe="festive"],
    .vibe-option[data-vibe="festive"] {
      background: var(--solid-accent);
      color: white;
    }

    .map-point[data-vibe="calm"],
    .vibe-option[data-vibe="calm"] {
      background: var(--solid-light-accent);
      color: var(--primary);
    }

    .map-point[data-vibe="suspicious"],
    .vibe-option[data-vibe="suspicious"] {
      background: var(--solid-primary);
      color: white;
    }

    .map-point[data-vibe="dangerous"],
    .vibe-option[data-vibe="dangerous"] {
      background: var(--solid-accent);
      color: white;
    }

    /* Settings sections */
    .settings-section {
      background: var(--glass-bg);
      border-radius: var(--border-radius);
      padding: var(--space-4);
      margin-bottom: var(--space-4);
      border: 1px solid var(--glass-border);
      backdrop-filter: var(--glass-blur-sm);
      -webkit-backdrop-filter: var(--glass-blur-sm);
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-3) 0;
      border-bottom: 1px solid var(--border);
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    /* Glass effect overlay for depth */
    .glass-effect {
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(
        circle at center,
        rgba(255, 255, 255, 0.1) 0%,
        rgba(255, 255, 255, 0) 70%
      );
      transform: rotate(30deg);
      pointer-events: none;
    }

    /* Add glass effect to primary cards */
    .bento-card-primary::after,
    .bento-card-accent::after,
    .bento-card-secondary::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(
        circle at center,
        rgba(255, 255, 255, 0.1) 0%,
        rgba(255, 255, 255, 0) 70%
      );
      transform: rotate(30deg);
      pointer-events: none;
      z-index: 1;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .container {
        padding: var(--space-3);
        padding-bottom: 80px;
      }

      .bento-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .bento-card-large {
        grid-column: span 2;
        grid-row: span 1;
      }

      .bento-card-medium {
        grid-column: span 2;
      }

      .bento-card-small {
        grid-column: span 1;
      }

      .action-buttons-section {
        margin: var(--space-4) 0;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-2);
      }

      .vibe-options {
        grid-template-columns: repeat(2, 1fr);
      }

      .mood-voting-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-1);
      }

      .hero-actions {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .bento-grid {
        grid-template-columns: 1fr;
      }

      .bento-card-large,
      .bento-card-medium,
      .bento-card-small {
        grid-column: span 1;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Compact Hero Section -->
    <section class="compact-hero">
      <div class="hero-logo">
        <i class="fas fa-shield-alt"></i>
      </div>

      <h1 class="hero-title">Neighborhood Safety Network</h1>
      <p class="hero-subtitle">Real-time safety insights from your community</p>

      <div class="hero-stats">
        <div class="hero-stat">
          <div class="hero-stat-value">85%</div>
          <div class="hero-stat-label">Safety Score</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value">42</div>
          <div class="hero-stat-label">Users Nearby</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value">12</div>
          <div class="hero-stat-label">Active Reports</div>
        </div>
      </div>

      <div class="hero-actions">
        <button class="hero-btn hero-btn-primary" id="heroViewMapBtn">
          <i class="fas fa-map"></i>
          View Map
        </button>
        <button class="hero-btn hero-btn-secondary" id="heroReportBtn">
          <i class="fas fa-plus"></i>
          Report
        </button>
      </div>

      <div class="hero-live-info">
        <div class="live-dot"></div>
        <span>Live updates from Downtown Area</span>
      </div>
    </section>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-item" id="connectionStatus">
        <i class="fas fa-circle-notch fa-spin"></i>
        <span>Connecting...</span>
      </div>
      <div class="status-item">
        <i class="fas fa-star"></i>
        <span>Rep:</span> <span id="userReputation">0</span>
      </div>
      <div class="status-item">
        <button id="locationBtn" class="refresh-btn" title="Enable location for local reports" style="margin-right: 8px;">
          <i class="fas fa-map-marker-alt"></i>
        </button>
        <button id="refreshBtn" class="refresh-btn" title="Refresh data">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
    </div>

    <!-- Main Navigation -->
    <nav class="app-nav">
      <button class="nav-btn active" data-view="main"><i class="fas fa-home"></i></button>
      <button class="nav-btn" data-view="map"><i class="fas fa-map"></i></button>
      <button class="nav-btn" data-view="reports"><i class="fas fa-list"></i></button>
      <button class="nav-btn" data-view="settings"><i class="fas fa-cog"></i></button>
    </nav>

    <!-- Main Content Area -->
    <main class="content-area">
      <!-- Main View -->
      <div id="mainView" class="view active">
        <div class="bento-grid">
          <!-- Community Stats Card (Large) - Updated to white -->
          <div class="bento-card bento-card-large bento-card-white">
            <div class="card-title">
              <i class="fas fa-chart-bar"></i>
              <span>Community Stats</span>
            </div>
            <div class="stats-grid" id="statsGrid">
              <div class="stat-card">
                <div class="stat-number" id="totalReports">24</div>
                <div class="stat-label">Reports</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="activeUsers">156</div>
                <div class="stat-label">Active Users</div>
              </div>
            </div>

            <!-- Color-coded Community Vibe Sidebar -->
            <div class="community-vibe-sidebar" id="communityVibeSidebar">
              <div class="sidebar-header">
                <span>Current Vibe Distribution</span>
                <div class="dominant-vibe" id="dominantVibe">
                  <i class="fas fa-peace"></i>
                  <span>Calm</span>
                  <span class="vibe-percentage" id="dominantVibePercentage">42%</span>
                </div>
              </div>
              <div class="vibe-sidebars-chart" id="vibeSidebarsChart">
                <div class="vibe-sidebar-item">
                  <div class="vibe-sidebar-label">
                    <i class="fas fa-users"></i>
                    <span>Crowded</span>
                  </div>
                  <div class="vibe-sidebar-bar">
                    <div class="vibe-sidebar-fill" style="width: 25%; background: var(--solid-primary);"></div>
                  </div>
                  <div class="vibe-sidebar-count">5</div>
                </div>
                <div class="vibe-sidebar-item">
                  <div class="vibe-sidebar-label">
                    <i class="fas fa-volume-up"></i>
                    <span>Noisy</span>
                  </div>
                  <div class="vibe-sidebar-bar">
                    <div class="vibe-sidebar-fill" style="width: 40%; background: var(--solid-secondary);"></div>
                  </div>
                  <div class="vibe-sidebar-count">8</div>
                </div>
                <div class="vibe-sidebar-item">
                  <div class="vibe-sidebar-label">
                    <i class="fas fa-glass-cheers"></i>
                    <span>Festive</span>
                  </div>
                  <div class="vibe-sidebar-bar">
                    <div class="vibe-sidebar-fill" style="width: 15%; background: var(--solid-accent);"></div>
                  </div>
                  <div class="vibe-sidebar-count">3</div>
                </div>
                <div class="vibe-sidebar-item">
                  <div class="vibe-sidebar-label">
                    <i class="fas fa-peace"></i>
                    <span>Calm</span>
                  </div>
                  <div class="vibe-sidebar-bar">
                    <div class="vibe-sidebar-fill" style="width: 65%; background: var(--solid-light-accent);"></div>
                  </div>
                  <div class="vibe-sidebar-count">13</div>
                </div>
                <div class="vibe-sidebar-item">
                  <div class="vibe-sidebar-label">
                    <i class="fas fa-eye-slash"></i>
                    <span>Suspicious</span>
                  </div>
                  <div class="vibe-sidebar-bar">
                    <div class="vibe-sidebar-fill" style="width: 10%; background: var(--gradient-secondary);"></div>
                  </div>
                  <div class="vibe-sidebar-count">2</div>
                </div>
                <div class="vibe-sidebar-item">
                  <div class="vibe-sidebar-label">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Dangerous</span>
                  </div>
                  <div class="vibe-sidebar-bar">
                    <div class="vibe-sidebar-fill" style="width: 5%; background: var(--gradient-radial);"></div>
                  </div>
                  <div class="vibe-sidebar-count">1</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Safety Hub Card (Medium) -->
          <div class="bento-card bento-card-medium">
            <div class="card-title">
              <i class="fas fa-shield-alt"></i>
              <span>Safety Hub</span>
            </div>
            <div class="safety-hub">
              <!-- Geofence Control -->
              <div class="geofence-control" id="geofenceControl">
                <div class="geofence-header">
                  <div class="geofence-icon">
                    <i class="fas fa-draw-polygon"></i>
                  </div>
                  <div class="geofence-info">
                    <span class="geofence-title">Geofence Monitoring</span>
                    <span class="geofence-status" id="geofenceStatusText">Disabled - Click to enable</span>
                  </div>
                  <button class="geofence-toggle" id="geofenceToggleBtn">
                    <div class="toggle-slider">
                      <div class="toggle-knob"></div>
                    </div>
                  </button>
                </div>
                <div class="geofence-description">
                  <span>Get notified when entering safe or risk zones</span>
                </div>
              </div>

              <div class="weather-alert" id="weatherAlert">
                <i class="fas fa-cloud-sun"></i>
                <div class="alert-content">
                  <span class="alert-title">Weather Alert</span>
                  <span class="alert-message">22°C - Clear sky. Enjoy your day!</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Area Mood Voting Card (Medium) -->
          <div class="bento-card bento-card-medium">
            <div class="card-title">
              <i class="fas fa-chart-pie"></i>
              <span>Area Mood Voting</span>
            </div>
            <div class="mood-voting-grid" id="moodVotingGrid">
              <div class="mood-vote-card" data-mood="chill">
                <div class="mood-emoji">😎</div>
                <div class="mood-name">Chill</div>
              </div>
              <div class="mood-vote-card" data-mood="excited">
                <div class="mood-emoji">🤩</div>
                <div class="mood-name">Excited</div>
              </div>
              <div class="mood-vote-card" data-mood="anxious">
                <div class="mood-emoji">😰</div>
                <div class="mood-name">Anxious</div>
              </div>
              <div class="mood-vote-card" data-mood="sad">
                <div class="mood-emoji">😢</div>
                <div class="mood-name">Sad</div>
              </div>
              <div class="mood-vote-card" data-mood="angry">
                <div class="mood-emoji">😠</div>
                <div class="mood-name">Angry</div>
              </div>
              <div class="mood-vote-card" data-mood="happy">
                <div class="mood-emoji">😀</div>
                <div class="mood-name">Happy</div>
              </div>
            </div>
            <div class="mood-voting-status" id="moodVotingStatus">
              <div style="font-size: var(--font-size-callout); color: var(--text-primary); margin-bottom: 5px;">
                <i class="fas fa-users"></i>
                <span>Population Mood</span>
              </div>
              <div style="font-size: var(--font-size-title2); font-weight: var(--font-weight-bold); color: var(--solid-primary);" id="populationMoodDisplay">
                <i class="fas fa-question-circle"></i>
                <span>Collecting votes...</span>
              </div>
            </div>
          </div>

          <!-- Safety Tips Card (Small) -->
          <div class="bento-card bento-card-small">
            <div class="card-title">
              <i class="fas fa-lightbulb"></i>
              <span>Safety Tips</span>
            </div>
            <div class="safety-tips" id="safetyTips">
              <div class="guideline-item">
                <i class="fas fa-users"></i>
                <span>Avoid crowded areas after dark</span>
              </div>
              <div class="guideline-item">
                <i class="fas fa-mobile-alt"></i>
                <span>Keep your phone charged</span>
              </div>
              <div class="guideline-item">
                <i class="fas fa-share-alt"></i>
                <span>Share your location with trusted contacts</span>
              </div>
            </div>
          </div>

          <!-- Emergency Contacts Card (Small) -->
          <div class="bento-card bento-card-small bento-card-accent">
            <div class="card-title">
              <i class="fas fa-phone-alt"></i>
              <span>Emergency</span>
            </div>
            <div style="text-align: center; padding: var(--space-3) 0;">
              <div style="font-size: var(--font-size-title1); font-weight: var(--font-weight-bold); margin-bottom: var(--space-2);">
                911
              </div>
              <div style="font-size: var(--font-size-caption1);">
                Tap for emergency services
              </div>
            </div>
          </div>

          <!-- Quick Report Card (Small) -->
          <div class="bento-card bento-card-small">
            <div class="card-title">
              <i class="fas fa-flag"></i>
              <span>Quick Report</span>
            </div>
            <div style="text-align: center; padding: var(--space-3) 0;">
              <button class="btn" style="width: 100%;" data-action="report">
                <i class="fas fa-plus"></i>
                Report Incident
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Map View -->
      <div id="mapView" class="view">
        <div class="bento-grid">
          <div class="bento-card bento-card-large">
            <div class="card-title">
              <i class="fas fa-map"></i>
              <span>Vibe Map</span>
            </div>
            <div id="mapContainer" class="map-container">
              <div class="map-header">
                <h3>Community Vibe Map</h3>
                <p>Heat map showing report density and vibe intensity</p>
              </div>
              <div id="mapVisualization" class="map-visualization">
                <!-- Map will be initialized here -->
              </div>
              <div class="map-controls">
                <button id="myLocationBtn" class="map-control-btn" title="Go to my location">
                  <i class="fas fa-crosshairs"></i>
                </button>
                <button id="heatmapToggle" class="map-control-btn active" title="Toggle heat map">
                  <i class="fas fa-fire"></i>
                </button>
                <button id="reportsToggle" class="map-control-btn" title="Toggle individual reports">
                  <i class="fas fa-map-marker-alt"></i>
                </button>
              </div>
              <div class="heatmap-legend">
                <div class="heatmap-legend-item">
                  <div class="heatmap-color" style="background: #00ff00;"></div>
                  <div class="heatmap-label">Low Activity</div>
                </div>
                <div class="heatmap-legend-item">
                  <div class="heatmap-color" style="background: #ffff00;"></div>
                  <div class="heatmap-label">Medium Activity</div>
                </div>
                <div class="heatmap-legend-item">
                  <div class="heatmap-color" style="background: #ff0000;"></div>
                  <div class="heatmap-label">High Activity</div>
                </div>
              </div>
              <div class="map-legend">
                <div class="legend-item"><i class="fas fa-users" style="color: var(--solid-primary);"></i> <span>Crowded</span></div>
                <div class="legend-item"><i class="fas fa-volume-up" style="color: var(--solid-secondary);"></i> <span>Noisy</span></div>
                <div class="legend-item"><i class="fas fa-glass-cheers" style="color: var(--solid-accent);"></i> <span>Festive</span></div>
                <div class="legend-item"><i class="fas fa-peace" style="color: var(--solid-light-accent);"></i> <span>Calm</span></div>
                <div class="legend-item"><i class="fas fa-eye-slash" style="color: var(--solid-primary);"></i> <span>Suspicious</span></div>
                <div class="legend-item"><i class="fas fa-exclamation-triangle" style="color: var(--solid-accent);"></i> <span>Dangerous</span></div>
              </div>
            </div>
          </div>

          <!-- Map Stats Card -->
          <div class="bento-card bento-card-medium">
            <div class="card-title">
              <i class="fas fa-chart-bar"></i>
              <span>Area Statistics</span>
            </div>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number">12</div>
                <div class="stat-label">Active Reports</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">85%</div>
                <div class="stat-label">Safety Score</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">3.2</div>
                <div class="stat-label">Avg. Vibe</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">42</div>
                <div class="stat-label">Users Nearby</div>
              </div>
            </div>
          </div>

          <!-- Recent Activity Card -->
          <div class="bento-card bento-card-small">
            <div class="card-title">
              <i class="fas fa-clock"></i>
              <span>Recent</span>
            </div>
            <div style="padding: var(--space-2) 0;">
              <div style="font-size: var(--font-size-caption1); margin-bottom: var(--space-2);">
                <i class="fas fa-users" style="color: var(--solid-primary);"></i>
                Crowded report - 5 min ago
              </div>
              <div style="font-size: var(--font-size-caption1); margin-bottom: var(--space-2);">
                <i class="fas fa-peace" style="color: var(--solid-light-accent);"></i>
                Calm vibe - 12 min ago
              </div>
              <div style="font-size: var(--font-size-caption1);">
                <i class="fas fa-volume-up" style="color: var(--solid-secondary);"></i>
                Noisy area - 25 min ago
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reports View -->
      <div id="reportsView" class="view">
        <div class="bento-grid">
          <!-- User Profile Card -->
          <div class="bento-card bento-card-medium bento-card-primary">
            <div class="card-title">
              <i class="fas fa-user"></i>
              <span>My Dashboard</span>
            </div>
            <div id="userProfileSection">
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-number" id="userTotalReports">5</div>
                  <div class="stat-label">My Reports</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number" id="userTotalUpvotes">23</div>
                  <div class="stat-label">Upvotes Received</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number" id="userReputationScore">42</div>
                  <div class="stat-label">Reputation</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number" id="userRank">15</div>
                  <div class="stat-label">Community Rank</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Achievements Card -->
          <div class="bento-card bento-card-medium">
            <div class="card-title">
              <i class="fas fa-trophy"></i>
              <span>Achievements</span>
            </div>
            <div id="userBadges" class="badge-showcase">
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2);">
                <div style="text-align: center; padding: var(--space-2);">
                  <i class="fas fa-star" style="color: gold; font-size: var(--font-size-title2);"></i>
                  <div style="font-size: var(--font-size-caption1); margin-top: var(--space-1);">First Report</div>
                </div>
                <div style="text-align: center; padding: var(--space-2);">
                  <i class="fas fa-users" style="color: var(--solid-primary); font-size: var(--font-size-title2);"></i>
                  <div style="font-size: var(--font-size-caption1); margin-top: var(--space-1);">Community Helper</div>
                </div>
                <div style="text-align: center; padding: var(--space-2);">
                  <i class="fas fa-bolt" style="color: var(--solid-accent); font-size: var(--font-size-title2);"></i>
                  <div style="font-size: var(--font-size-caption1); margin-top: var(--space-1);">Quick Reporter</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity Card -->
          <div class="bento-card bento-card-large">
            <div class="card-title">
              <i class="fas fa-history"></i>
              <span>Recent Activity</span>
            </div>
            <div id="userRecentActivity" class="reports-container">
              <div class="report-item">
                <div class="report-info">
                  <div class="report-type">
                    <i class="fas fa-users" style="color: var(--solid-primary);"></i>
                    <span>Crowded Area Report</span>
                  </div>
                  <div class="report-details">Central Park - Lots of people gathering</div>
                  <div class="report-meta">
                    <span>2 hours ago</span>
                    <span>•</span>
                    <span>15 upvotes</span>
                  </div>
                </div>
                <div class="report-actions">
                  <button class="vote-btn upvote-btn active" aria-disabled="true">
                    <i class="fas fa-chevron-up"></i>
                  </button>
                </div>
              </div>
              <div class="report-item">
                <div class="report-info">
                  <div class="report-type">
                    <i class="fas fa-volume-up" style="color: var(--solid-secondary);"></i>
                    <span>Noisy Area Report</span>
                  </div>
                  <div class="report-details">Main Street - Construction noise</div>
                  <div class="report-meta">
                    <span>5 hours ago</span>
                    <span>•</span>
                    <span>8 upvotes</span>
                  </div>
                </div>
                <div class="report-actions">
                  <button class="vote-btn upvote-btn active" aria-disabled="true">
                    <i class="fas fa-chevron-up"></i>
                  </button>
                </div>
              </div>
              <div class="report-item">
                <div class="report-info">
                  <div class="report-type">
                    <i class="fas fa-peace" style="color: var(--solid-light-accent);"></i>
                    <span>Calm Area Report</span>
                  </div>
                  <div class="report-details">Library area - Quiet and peaceful</div>
                  <div class="report-meta">
                    <span>1 day ago</span>
                    <span>•</span>
                    <span>12 upvotes</span>
                  </div>
                </div>
                <div class="report-actions">
                  <button class="vote-btn upvote-btn active" aria-disabled="true">
                    <i class="fas fa-chevron-up"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings View -->
      <div id="settingsView" class="view">
        <div class="bento-grid">
          <div class="bento-card bento-card-large">
            <div class="card-title">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </div>

            <div class="settings-section">
              <h3>Account</h3>
              <div class="setting-item">
                <span>Username</span>
                <span id="settingsUsername">-</span>
              </div>
              <div class="setting-item">
                <span>Reputation</span>
                <span id="settingsReputation">42</span>
              </div>
              <div class="setting-item">
                <span>Account Actions</span>
                <button class="btn" id="logoutBtn">Logout</button>
              </div>
            </div>

            <div class="settings-section">
              <h3>Preferences</h3>
              <div class="setting-item">
                <span>Language</span>
                <select id="languageSelect">
                  <option value="en">English</option>
                  <option value="ar">العربية</option>
                </select>
              </div>
              <div class="setting-item">
                <span>Theme</span>
                <button class="btn" id="themeToggle" style="padding: 8px 16px;">
                  <i class="fas fa-moon"></i>
                  Dark Mode
                </button>
              </div>
            </div>

            <div class="settings-section">
              <h3>Privacy & Policy</h3>
              <div class="setting-item">
                <span>Data Collection</span>
                <button class="btn" data-action="privacy-policy">View Policy</button>
              </div>
              <div class="setting-item">
                <span>Location Data</span>
                <span>Used for safety reports only</span>
              </div>
              <div class="setting-item">
                <span>Anonymous Reporting</span>
                <span>Reports are anonymous by default</span>
              </div>
            </div>

            <div class="settings-section">
              <h3>About</h3>
              <p>HyperApp helps communities stay informed about safety conditions in their area.</p>
            </div>
          </div>

          <!-- App Info Card -->
          <div class="bento-card bento-card-small">
            <div class="card-title">
              <i class="fas fa-info-circle"></i>
              <span>App Info</span>
            </div>
            <div style="padding: var(--space-3) 0;">
              <div style="margin-bottom: var(--space-2);">
                <strong>Version</strong><br>
                1.0.0
              </div>
              <div style="margin-bottom: var(--space-2);">
                <strong>Last Updated</strong><br>
                Oct 6, 2025
              </div>
              <div>
                <strong>Community</strong><br>
                156 active users
              </div>
            </div>
          </div>

          <!-- Support Card -->
          <div class="bento-card bento-card-small">
            <div class="card-title">
              <i class="fas fa-headset"></i>
              <span>Support</span>
            </div>
            <div style="text-align: center; padding: var(--space-3) 0;">
              <button class="btn" style="width: 100%; margin-bottom: var(--space-2);">
                <i class="fas fa-question-circle"></i>
                Help Center
              </button>
              <button class="btn" style="width: 100%;">
                <i class="fas fa-envelope"></i>
                Contact Us
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Report Modal -->
  <div id="reportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Report Vibe</h2>
        <span class="close" data-dismiss="reportModal">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>What's the vibe?</label>
          <div class="vibe-options">
            <div class="vibe-option" data-vibe="crowded">
              <i class="fas fa-users"></i>
              <span>Crowded</span>
            </div>
            <div class="vibe-option" data-vibe="noisy">
              <i class="fas fa-volume-up"></i>
              <span>Noisy</span>
            </div>
            <div class="vibe-option" data-vibe="festive">
              <i class="fas fa-glass-cheers"></i>
              <span>Festive</span>
            </div>
            <div class="vibe-option" data-vibe="calm">
              <i class="fas fa-peace"></i>
              <span>Calm</span>
            </div>
            <div class="vibe-option" data-vibe="suspicious">
              <i class="fas fa-eye-slash"></i>
              <span>Suspicious</span>
            </div>
            <div class="vibe-option" data-vibe="dangerous">
              <i class="fas fa-exclamation-triangle"></i>
              <span>Dangerous</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Notes (optional)</label>
          <textarea id="reportNotes" placeholder="Add details about what you're experiencing"></textarea>
        </div>
        <button class="btn" id="submitReportBtn">Submit Report</button>
      </div>
    </div>
  </div>

  <!-- Emergency Modal -->
  <div id="emergencyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Emergency Report</h2>
        <span class="close" data-dismiss="emergencyModal">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Emergency Type</label>
          <select id="emergencyType">
            <option value="medical">Medical Emergency</option>
            <option value="police">Police Needed</option>
            <option value="fire">Fire Emergency</option>
            <option value="other">Other Emergency</option>
          </select>
        </div>

        <div class="form-group">
          <label>Details</label>
          <textarea id="emergencyDetails" placeholder="Please provide details about the emergency" required></textarea>
        </div>
        <button class="btn btn-emergency" id="submitEmergencyBtn">Report Emergency</button>
      </div>
    </div>
  </div>

  <!-- Load services and main app -->
  <script src="services/ConfigService.js"></script>
  <script src="services/NotificationService.js"></script>
  <script src="services/AuthService.js"></script>
  <script src="services/ErrorHandler.js"></script>
  <script src="db-validation.js"></script>
  <script src="app.js"></script>
</body>
</html>
